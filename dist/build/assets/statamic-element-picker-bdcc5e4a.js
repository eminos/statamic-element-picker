var L=Object.defineProperty;var P=(e,t,n)=>t in e?L(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var c=(e,t,n)=>(P(e,typeof t!="symbol"?t+"":t,n),n);class C{constructor(t){c(this,"status","idle");c(this,"options",{namespace:"",window,inspector:null,htmlClass:!0,blockRedirection:!1,createInspector:!1,excludes:[]});c(this,"getInspector",()=>{if(typeof this.options.inspector=="string"){var t=this.options.window.document.querySelector(this.options.inspector);if(t)return t;throw Error("inspector element not found")}if(this.options.inspector instanceof Element)return this.options.inspector;if(!this.options.inspector&&this.options.createInspector){var n=this.options.window.document.createElement("div");return n.className="inspector-element",this.options.window.document.body.appendChild(n),n}throw Error("inspector must be a css selector or a DOM element")});c(this,"getExclusionSelector",()=>this.options.excludes.join(","));c(this,"applyOptions",t=>{if(typeof t!="object")throw Error("options is expected to be an object");for(var n in t)t.hasOwnProperty(n)&&(this.options[n]=t[n])});c(this,"eventEmitter",t=>{if(t.preventDefault(),this.eventController("hook",t)!==!1){var n=t.target;if(!(!n||n===this.options.inspector)){var i=this.getExclusionSelector();if(i){var o=Array.prototype.slice.call(this.options.window.document.querySelectorAll(i));if(o.indexOf(n)>=0)return}if(t.type==="mouseover"){var s=n.getBoundingClientRect(),f=this.options.window.scrollY||this.options.window.document.documentElement.scrollTop,l=this.options.window.scrollX||this.options.window.document.documentElement.scrollLeft,r=s.width,a=s.height,v=Math.max(0,s.top+f),p=Math.max(0,s.left+l);this.options.inspector.style.top=v+"px",this.options.inspector.style.left=p+"px",this.options.inspector.style.width=r+"px",this.options.inspector.style.height=a+"px"}this.eventController(t.type,n,t)}}});c(this,"engine",t=>{var n=this.options.window.document.querySelector("html");t==="start"?(this.options.blockRedirection===!0&&(this.options.window.onbeforeunload=function(){return!0}),this.options.window.document.addEventListener("click",this.eventEmitter),this.options.window.document.addEventListener("mouseover",this.eventEmitter),this.options.htmlClass===!0&&(n.className+=" "+this.options.namespace),this.status="running"):t==="stop"&&(this.options.window.document.removeEventListener("click",this.eventEmitter),this.options.window.document.removeEventListener("mouseover",this.eventEmitter),this.options.htmlClass===!0&&(n.className=n.className.replace(" "+this.options.namespace,"")),this.options.blockRedirection===!0&&(this.options.window.onbeforeunload=void 0),this.status="stopped")});c(this,"eventController",(t,n,i)=>{if(this.options[t]){if(typeof this.options[t]!="function")throw Error("event handler must be a function: "+t);return this.options[t].call(null,n,i)}});c(this,"start",t=>{t&&this.configure(t),this.options.inspector=this.getInspector(),this.eventController("starting"),this.engine("start"),this.eventController("started")});c(this,"stop",t=>{this.eventController("stopping"),this.engine("stop"),t===!0&&(this.options.inspector.style.top="",this.options.inspector.style.left="",this.options.inspector.style.width="",this.options.inspector.style.height=""),this.options.createInspector===!0&&(this.options.inspector.remove(),this.options.inspector=void 0),this.eventController("stopped")});c(this,"eventBinder",(t,n)=>{if(typeof t!="string")throw Error("event name is expected to be a string but got: "+typeof t);if(typeof n!="function")throw Error("event handler is not a function for: "+t);this.options[t]=n});this.applyOptions(t)}}let u,_;function $(e,t){if(e.nodeType!==Node.ELEMENT_NODE)throw new Error("Can't generate CSS selector for non-element node type.");if(e.tagName.toLowerCase()==="html")return"html";const n={root:document.body,idName:o=>!0,className:o=>!0,tagName:o=>!0,attr:(o,s)=>!1,seedMinLength:1,optimizedMinLength:2,threshold:1e3,maxNumberOfTries:1e4};u={...n,...t},_=R(u.root,n);let i=d(e,"all",()=>d(e,"two",()=>d(e,"one",()=>d(e,"none"))));if(i){const o=N(S(i,e));return o.length>0&&(i=o[0]),w(i)}else throw new Error("Selector was not found.")}function R(e,t){return e.nodeType===Node.DOCUMENT_NODE?e:e===t.root?e.ownerDocument:e}function d(e,t,n){let i=null,o=[],s=e,f=0;for(;s;){let l=g(U(s))||g(...O(s))||g(...H(s))||g(Z(s))||[x()];const r=D(s);if(t=="all")r&&(l=l.concat(l.filter(y).map(a=>m(a,r))));else if(t=="two")l=l.slice(0,1),r&&(l=l.concat(l.filter(y).map(a=>m(a,r))));else if(t=="one"){const[a]=l=l.slice(0,1);r&&y(a)&&(l=[m(a,r)])}else t=="none"&&(l=[x()],r&&(l=[m(l[0],r)]));for(let a of l)a.level=f;if(o.push(l),o.length>=u.seedMinLength&&(i=E(o,n),i))break;s=s.parentElement,f++}return i||(i=E(o,n)),!i&&n?n():i}function E(e,t){const n=N(q(e));if(n.length>u.threshold)return t?t():null;for(let i of n)if(k(i))return i;return null}function w(e){let t=e[0],n=t.name;for(let i=1;i<e.length;i++){const o=e[i].level||0;t.level===o-1?n=`${e[i].name} > ${n}`:n=`${e[i].name} ${n}`,t=e[i]}return n}function T(e){return e.map(t=>t.penalty).reduce((t,n)=>t+n,0)}function k(e){const t=w(e);switch(_.querySelectorAll(t).length){case 0:throw new Error(`Can't select any node with this selector: ${t}`);case 1:return!0;default:return!1}}function U(e){const t=e.getAttribute("id");return t&&u.idName(t)?{name:"#"+CSS.escape(t),penalty:0}:null}function O(e){return Array.from(e.attributes).filter(n=>u.attr(n.name,n.value)).map(n=>({name:`[${CSS.escape(n.name)}="${CSS.escape(n.value)}"]`,penalty:.5}))}function H(e){return Array.from(e.classList).filter(u.className).map(n=>({name:"."+CSS.escape(n),penalty:1}))}function Z(e){const t=e.tagName.toLowerCase();return u.tagName(t)?{name:t,penalty:2}:null}function x(){return{name:"*",penalty:3}}function D(e){const t=e.parentNode;if(!t)return null;let n=t.firstChild;if(!n)return null;let i=0;for(;n&&(n.nodeType===Node.ELEMENT_NODE&&i++,n!==e);)n=n.nextSibling;return i}function m(e,t){return{name:e.name+`:nth-child(${t})`,penalty:e.penalty+1}}function y(e){return e.name!=="html"&&!e.name.startsWith("#")}function g(...e){const t=e.filter(I);return t.length>0?t:null}function I(e){return e!=null}function*q(e,t=[]){if(e.length>0)for(let n of e[0])yield*q(e.slice(1,e.length),t.concat(n));else yield t}function N(e){return[...e].sort((t,n)=>T(t)-T(n))}function*S(e,t,n={counter:0,visited:new Map}){if(e.length>2&&e.length>u.optimizedMinLength)for(let i=1;i<e.length-1;i++){if(n.counter>u.maxNumberOfTries)return;n.counter+=1;const o=[...e];o.splice(i,1);const s=w(o);if(n.visited.has(s))return;k(o)&&z(o,t)&&(yield o,n.visited.set(s,!0),yield*S(o,t,n))}}function z(e,t){return _.querySelector(w(e))===t}function A(e,t,n,i,o,s,f,l){var r=typeof e=="function"?e.options:e;t&&(r.render=t,r.staticRenderFns=n,r._compiled=!0),i&&(r.functional=!0),s&&(r._scopeId="data-v-"+s);var a;if(f?(a=function(h){h=h||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!h&&typeof __VUE_SSR_CONTEXT__<"u"&&(h=__VUE_SSR_CONTEXT__),o&&o.call(this,h),h&&h._registeredComponents&&h._registeredComponents.add(f)},r._ssrRegister=a):o&&(a=l?function(){o.call(this,(r.functional?this.parent:this).$root.$options.shadowRoot)}:o),a)if(r.functional){r._injectStyles=a;var v=r.render;r.render=function(M,b){return a.call(b),v(M,b)}}else{var p=r.beforeCreate;r.beforeCreate=p?[].concat(p,a):[a]}return{exports:e,options:r}}const B={setup(){return{finder:$}},mixins:[Fieldtype],data(){return{Picker:null,urlComponent:null}},computed:{url(){if(this.config.url_source==="sibling_or_ancestor"&&this.urlComponent)return this.urlComponent.value;if(this.config.url_source==="field_config")return this.config.url},buttonTooltip(){return this.url?`Go to ${this.url} and pick an element`:"Pick an element right here"},buttonTooltipMissingUrl(){if(this.config.url_source==="sibling_or_ancestor"&&!this.urlComponent)return`The field "${this.config.url_field_handle}" could not be found.`;if(this.config.url_source==="sibling_or_ancestor"&&this.urlComponent&&!this.urlComponent.value)return`Missing URL in field "${this.urlComponent.config.display}".`;if(this.config.url_source==="field_config"&&!this.config.url)return"Missing URL in field config."},isUrlSameOrigin(){if(this.url)try{return new URL(this.url).origin===window.location.origin}catch{return!1}}},methods:{startPicking(){this.url?this.startPickingOnUrl():setTimeout(()=>{this.startPickingHere()},100)},startPickingHere(){this.Picker=new C({window,createInspector:!0,blockRedirection:!1,click:e=>{const t=this.finder(e,{root:document.body});this.update(t),this.Picker.stop()}}),this.Picker.start()},startPickingOnUrl(){const e=window.open(this.url),t=new URL(this.url).origin,n=i=>{i.origin===t&&i.data.source==="Picker"&&this.update(i.data.selector)};window.addEventListener("message",n),e.onload=()=>{e.finder=this.finder;const i=e.document.createElement("style");i.innerHTML=".inspector-element { position: absolute ;z-index: 999; pointer-events: none; border: 2px solid tomato; transition:all .2s; background-color: #b4bb6933 }",e.document.head.appendChild(i),e.Picker=new C({window:e,createInspector:!0,blockRedirection:!1,click:o=>{const s=e.finder(o,{root:e.document.body});window.postMessage({source:"Picker",selector:s},t),e.close(),setTimeout(()=>{window.removeEventListener("message",n)},100)}}),e.Picker.start()}}},mounted(){if(this.config.url_source==="sibling_or_ancestor"){let e=this.$parent;for(;e;)e.$children.forEach(t=>{t.field&&t.field.handle===this.config.url_field_handle?this.urlComponent=t:t.config&&t.config.handle===this.config.url_field_handle&&(this.urlComponent=t)}),e=e.$parent}}};var V=function(){var t=this,n=t._self._c;return n("div",{staticClass:"relative"},[n("text-input",{staticClass:"[&_input]:elpi-pr-9",attrs:{value:t.value},on:{input:t.update}}),t.config.url_source?t._e():n("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.buttonTooltip,delay:50,autoHide:!1},expression:"{content: buttonTooltip, delay: 50, autoHide: false}"}],staticClass:"btn btn-xs absolute elpi-top-1.5 elpi-right-1.5 elpi-px-0",on:{click:t.startPicking}},[n("svg",{staticClass:"text-sm",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"}},[n("path",{attrs:{fill:"currentColor",d:"M12 14a2 2 0 1 0 0-4a2 2 0 0 0 0 4Zm-6-2a6 6 0 1 1 12 0a6 6 0 0 1-12 0Zm6-4a4 4 0 1 0 0 8a4 4 0 0 0 0-8ZM2 12C2 6.477 6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12Zm10-8a8 8 0 1 0 0 16a8 8 0 0 0 0-16Z"}})])]),t.config.url_source&&t.url?n("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.buttonTooltip,delay:50,autoHide:!1},expression:"{content: buttonTooltip, delay: 50, autoHide: false}"}],staticClass:"btn btn-xs absolute elpi-top-1.5 elpi-right-1.5 elpi-px-0",on:{click:t.startPicking}},[n("svg",{staticClass:"w-4 elpi-mx-1 text-sm",attrs:{xmlns:"http://www.w3.org/2000/svg",width:"512",height:"512",viewBox:"0 0 512 512"}},[n("path",{attrs:{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48M336 64h112v112M224 288L440 72"}})])]):t._e(),t.config.url_source&&!t.url?n("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:t.buttonTooltipMissingUrl,delay:50,autoHide:!1},expression:"{content: buttonTooltipMissingUrl, delay: 50, autoHide: false}"}],staticClass:"btn btn-xs elpi-text-yellow-500 hover:!elpi-text-yellow-500 absolute elpi-top-1.5 elpi-right-1.5 elpi-px-0"},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"}},[n("path",{attrs:{fill:"currentColor",d:"M12 17q.425 0 .713-.288T13 16q0-.425-.288-.713T12 15q-.425 0-.713.288T11 16q0 .425.288.713T12 17Zm-1-4h2V7h-2v6Zm1 9q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Z"}})])]):t._e(),t.url&&!t.isUrlSameOrigin?n("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:{content:"The URL must be on the same origin as the current page.",delay:50,autoHide:!1},expression:"{content: 'The URL must be on the same origin as the current page.', delay: 50, autoHide: false}"}],staticClass:"btn btn-xs text-red-500 absolute elpi-top-1.5 elpi-right-1.5 elpi-px-0"},[n("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"}},[n("path",{attrs:{fill:"currentColor",d:"M12 17q.425 0 .713-.288T13 16q0-.425-.288-.713T12 15q-.425 0-.713.288T11 16q0 .425.288.713T12 17Zm-1-4h2V7h-2v6Zm1 9q-2.075 0-3.9-.788t-3.175-2.137q-1.35-1.35-2.137-3.175T2 12q0-2.075.788-3.9t2.137-3.175q1.35-1.35 3.175-2.137T12 2q2.075 0 3.9.788t3.175 2.137q1.35 1.35 2.138 3.175T22 12q0 2.075-.788 3.9t-2.137 3.175q-1.35 1.35-3.175 2.138T12 22Z"}})])]):t._e()],1)},F=[],W=A(B,V,F,!1,null,null,null,null);const X=W.exports;Statamic.booting(()=>{Statamic.$components.register("element_picker-fieldtype",X)});
